# Запуск простых операций

После того, как вы настроили соединение с узлами, а также сформировали инвентарный файл, то можете перейти к запуску самых первых комманд в Ansible.

В общем случае, запуск команды будет выглядеть в следующем виде:

```YAML
ansible host/group [-i <path-to-inventory>] [-u <username>] -m <module> [-a <command_argument>]
```

- host/group - либо имя узла, либо имя группы, описанное в файле инвентории для выполнения операции.
- path-to-inventory - путь до файла-инвентаря. Если не задан, то используется */etc/ansible/hosts*.
- username - имя пользователя, под которым выполнять операции. По умолчанию используется имя текущего пользователя, под которым запущен Ansible.
- module - название модуля для запуска. Обязательный параметр. Если не задан, то предполагается, что запускается модуль *command*.
- command_argument - дополнительные опции для запуска. Представляется в виде строки. Конкретные опции зависят от запускаемого модуля.



## Проверяем связь по SSH

Для того, чтобы просто протестировать доступность узла по SSH через Ansible, существует модуль **ping**. Он установить соединение по SSH, и если соединение успешное, то вернет успешный ответ.

```YAML
ansible workshop -i inventory.yaml -m ping
```

![](images/PING.png)


## Выполняем команды в терминале

Существует как минимум 2 модуля, позволяющие выполнять удаленные команды: **shell** и **command**. Отличие в следующем:

- *command* позволяет выполнять команды "безопасно", конкретная строка с коммандами для выполенния экранируется, поэтому терминальные символы `|><&` не работают
- *shell* запускает команды в интерпретаторе узла, тем самым полностью эмулируется работа от лица пользователя, но при этом за оператором Ansible остается ответственность по контролю за безопасностью команд.

```YAML
ansible workshop -i inventory.yaml -m command -a "whoami -a"
ansible workshop -i inventory.yaml -m shell -a "echo $(uname -a)"
```


![](images/command.png)
![](images/shell.png)


## Устанавливаем веб-сервер nginx

В Ansible есть множество модулей для управления пакетной базой (yum, apt, rpm, dpkg). Так как в этом занятии используется CentOS, то для установки пакета nginx, нам необходимо выполнить:

```YAML
ansible workshop -i inventory.yaml -m yum -a "name=nginx state=latest"
```

Модуль **yum** принимает как минимум 2 параметра:
- name - определяет название пакета. Разрешено указывать версию пакета.
- state - ожидаемое состояние пакета. *Latest* - будет установлен или обновлен до самой актуальной версии пакета. Есть и другие состояния (absent, present)

Выполнение модуля занимает определенное время.

![](images/yum.png)



## Перезапускаем nginx и добавляем в автозагрузку

Если система работает под управлением systemd, а также описан сервис, то есть универсальный способ для его управления - модуль **service**


Для того, чтобы перезапустить сервис nginx и добавить его в автоматическую загрузку, то нужно выполнить:

```YAML
ansible workshop -i inventory.yaml -m service -a "name=nginx state=started enabled=yes"
```

- name - название сервиса
- state - необходимое состояние. Также есть stopped, restarted, reloaded.
- enabled - булева опция, которая сигнализирует о том, запускается ли сервис автоматически или нет.


![](images/service.png)


## Перезапускаем всю машину

В случае, если вам нужно перезапустить машину, то модуль **reboot** сделает всю работу. У него множество опций, одна из самых важных = reboot_timeout - определяет время, какое Ansible будет ждать для проверки статуса машины.

```YAML
ansible workshop -i inventory.yaml -m reboot -a "reboot_timeout=500"
```

![](images/reboot.png)
